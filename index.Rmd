---
title: "Scripting for Geo-Information Sciences, demonstration of capabilities"
author: "Lo√Øc Dutrieux, Jan Verbesselt"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: united
    toc: true
    toc_depth: 4
    number_sections: true
---

# Today's items

## ToDo in the morning

- Finalise yesterdays [lesson and excercise](https://geoscripting-wur.github.io/Scripting4GeoIntro/#gettingstarted)
- Have a look at the demo's below. Just run and see.

## Objective of today

Demonstration of geo-scripting potential. This will be done by providing geo-spatial showcases (e.g. data manipulation, visualization, Analysis). 
Every showcase will be followed by:

- A reflection of what is the interest of using scripting for that particular problem
- An assessment of the R knowledge required to perform that particular problem

## Learning outcomes of today:

The objective of that lecture is to provide an overview of the capabilities of scripting to solve common problems of the Geo-Information world. The lesson is organized as a set of examples that you can run, visualize the output and understand how the use of scripting was beneficial to tackling the geo-issue. Following each example a reflection is provided on the interest of using scripting for tackling that particular issue as well as associated scripting skills that were required in the example.

So more specifically, at the end of the day you should:

* Have an idea of what can be achieved using scripting
* Identify a situation where the use of scripting is beneficial over click based approach
* Have identified how scripting can benefit your own project e.g. master thesis research questions

# Examples

## Integrated analysis chain (from raw data download to figures/statistical output)

## Automation

The use of scripting is particularly well suited for automation. Automated systems can take different forms; from online systems that deliver updated information every day without human intervention needed. [Add example here (whether forecast?)]. To more simple systems that, when extecuted, are able to find data themselves in a directory architecture and recognize patterns to extract meta-information (eg: Extract date from a satellite image file name).

The example above, that uses height data could easily be ran for every country of the world with minimal human intervention, and therefore also constitute an other case of automation.

## Visualization

## Flexibility
With GIS software you are often limited to set of feature the software provides and anything beyond is either very hard to implement or even impossible. Scripting offers a much greater flexibility, to:

    * Explore your data in all its dimensions
    * Implement complex and custom made algorithms and functions.

## Reproducibility
All examples shown in this demo have at least one characteristic in common; they are all **reproducible**. While you may not always remember the parameters you have selected when analyzing or creating map in a GIS environment, scripting leaves a fully reproducible mark of what you have done. 

## Efficient Vector/Raster handling

### The example

In the script below we do the following:

- download SRTM data for a country e.g. Belgium
- randomly sample height data
- visualise results in an interactive map

Note: If you finished everything of lesson 1, you can use the script below to analyse height (or climate data) for your own country by modifying the script below.

```{r, eval=TRUE, message=FALSE, fig.align='center', fig.width=6, fig.lp="Randomly sample height in Belgium"}

## libraries needed
library(raster)
library(spatstat)
library(rgeos)
## you can choose your own country here
bel <- getData('alt', country='BEL', mask=TRUE) ## SRTM 90m height data
belshp <- getData('GADM', country='BEL', level=2) ## administrative boundaries
## create random points
dran <- runifpoint(500, win = as.vector(extent(bel)))
## make the random point spatial points
S <- SpatialPoints(data.frame(x = dran$x, y = dran$y), 
            proj4string = CRS(proj4string(belshp)))
## select only the once within belgium
Sint <- gIntersection(S, belshp)
## create a map
plot(bel)
plot(belshp, add=TRUE)
plot(Sint, add = TRUE, col = "red", pch = 19, cex = 0.2)
```

Now we can sample the height data and visualise in the nice interactive scatterplot:

```{r, message=FALSE}
suppressPackageStartupMessages(library(googleVis))
out <- extract(bel, Sint, df = TRUE, sp = TRUE)
df <- data.frame(out@coords, height = out@data, row.names=NULL)
names(df) <- c('x', 'y', 'height')
df$x <- NULL
```

```{r, results='asis', echo=FALSE, fig.align='center'}
sc <- gvisScatterChart(data=df,
                        options=list(width=600, height=500,
                            legend='none',
                            hAxis="{title:'Y (Latitude)'}",
                            vAxis="{title:'Height'}"))
print('<center>')
print(sc)
print('<center>')
```

### The contribution of scripting

- ability to automaticaliy download data from any place in the world
- quick and efficient analysis by sampling data randomly
- can easiliy be repeated for other countries, other datasets

The big advantage of scripting here is that you can efficiently analyse and visualise for any kind of data set.

### Basic scriping skills required

Being able to:
- handle raster and vector data
- spatial analysis (point sampling)
- visualise spatial relationships

## An automated raster processing chain (from data download to final map)

### The example

### Contribution of scripting

* Reproducibility

### Basic scipting skills required

* String handling
* List queries
* Error handling

## Interactive maps

The map below (created using the googleVis package) displays statistics about the national parks of Europe. The data is automatically read from [the wikipedia page](http://en.wikipedia.org/wiki/List_of_national_parks#Europe), cleaned and formatted in a data frame, and a webmap is created using the `gvisGeoChart()` function. If you hover over the dots, the value of the mapped variables is displayed. The googleVis package provides wrappers to easily produce such kind of maps using the [google visualization API](https://google-developers.appspot.com/chart/interactive/docs/gallery/geochart).

```{r, echo=FALSE, results='asis'}
library(googleVis)
library(XML)

# Read table from html
url <- "http://en.wikipedia.org/wiki/List_of_national_parks"
x <- readHTMLTable(readLines(url), which=3, stringsAsFactors = FALSE)

# Clean up df 
colnames (x) <- c('country', 'oldest', 'number', 'area_tot', 'country_percentage')
x$oldest <- as.numeric(x$oldest)
x$number <- as.numeric(gsub("\\*", "", x$number))
x$area_tot <- as.numeric(gsub("(,)|(\\[.*\\])", "", x$area_tot))
x$country_percentage <- as.numeric(gsub("(%)|(\\[.*\\])", "", x$country_percentage))

nationalParks <- x

g <- gvisGeoChart(nationalParks, locationvar="country", colorvar = "oldest", sizevar = "number",
                  options=list(region="150", displayMode="markers", colorAxis="{colors: ['green', 'blue']}"))
print('<center>')
print(g)
print('</center>')
```

## A shiny map

The above map is nice, but still pretty static; it only display two variables, which we did not choose. The year the first park was created for the dot color, and the total number of parks in the country for the dot size. To make that map a bit more interactive we can embed it in a shiny App. Shiny is among the lattest developments of the R world, supported by RStudio; it provides the possibility to create interactive plots. These app can either be ran in an RStudio session or online.
The app below allows you to select the variables you want to map relating to national park of europe.

<center>
<iframe src="http://loicd.shinyapps.io/shinyGoogleVis" width="600" height="750" frameborder="0">Loading</iframe>
</center>

### Contribution of scripting
### Basic scipting skills required

* dataframe manipulation



# Today's summary

To summarize, we saw today that scripting can be used for many purposes:

* Automate steps and deal with large amounts of data
* Solve complex problems (run custom made functions, while traditional GIS environments are limited to the features they provide)
* Make work reproducible (also beneficial for collaboration)
* Visualize data and build interactive geo data visualization tools


# Assignment

Submit a 1/2 page document where you identify the potential contribution of Geo-scripting for yourself, as well as the specific R or python knowledge you would need to learn about. Keep it short, to the point and structured.


# Inspiration and More info

- http://www.magesblog.com/2012/05/interactive-reports-in-r-with-knitr-and.html
- https://gis.stackexchange.com/questions/93096/how-to-perform-a-true-gis-clip-of-polygons-layer-using-a-polygon-layer-in-r

Yet another tutorial:

- https://pakillo.github.io/R-GIS-tutorial/
- http://github.com/mages/googleVis

About projections and code: https://www.nceas.ucsb.edu/scicomp/recipes/projections


<!--Demonstrate potential
Trigger interest
Help students mapping (in their mind) the concepts and knowledge they will learn and require later in the course
This will be done by providing showcases of about everything (data manipulation, visualization, Analysis). Every showcase fill be followed by:
A reflection on what is the interest of using scripting for that particular problem
An assessment of the R knowledge required to perform that particular problem
This lesson should be structured analogically to the course overall.

Example showcases:
An automated raster processing chain (from raw input (or download) to end product)
Make a reproducible map
Extract features immediately followed by statistical analysis
Communicate result with a beautiful interactive (shiny) map
Bonus: If every showcase is embedded into a real world story, that is definitely a bonus
-->


