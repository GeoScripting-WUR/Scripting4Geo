---
title: "Scripting for Geo-Information Sciences, demonstration of capabilities"
author: "Lo√Øc Dutrieux, Jan Verbesselt"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: united
    toc: true
    toc_depth: 4
    number_sections: true
---

# Today's items

## ToDo in the morning

- Finalise yesterdays lesson
- Have a look at the demo's below. Just run and see.

## Objective of today

Demonstration of geo-scripting potential. This will be done by providing geo-spatial showcases (e.g. data manipulation, visualization, Analysis). 
Every showcase fill be followed by:
A reflection on what is the interest of using scripting for that particular problem
An assessment of the R knowledge required to perform that particular problem

## Learning outcomes of today:

The objective of that lecture is to provide an overview of the capabilities of scripting to solve common problems of the Geo-Information world. The lesson is organized as a set of examples that you can run, visualize the output and understand how the use of scripting was beneficial to tackling the geo-issue. Following each example a reflection is provided on the interest of using scripting for tackling that particular issue as well as associated scripting skills that were required in the example.

So more specifically, at the end of the day you should:

* Have an overview of what can be achieved using scripting
* Identify a situation where the use of scripting is beneficial over click based approach
* Be able to identify which basic scripting skills are required for different Geo-issues
* Have identified how scripting can benefit your own project e.g. master thesis research questions

# Today's learning Objectives

# Examples

## Vector/Raster handling and visualisation

### The example (script)

- download temperature anomaly data/ VCF data/ Landsat/shape file kenya
- randomly sample different locations
- analyse temperature (standard deviation) and visualise results on a spatial map
- visualise results in an interactive map

[more info](https://gis.stackexchange.com/questions/93096/how-to-perform-a-true-gis-clip-of-polygons-layer-using-a-polygon-layer-in-r)


```{r, eval=FALSE, echo = FALSE}
library(raster)
library(sp)
library(spatstat)
library(rgeos)

bel <- getData('alt', country='BEL', mask=TRUE)
belshp <- getData('GADM', country='BEL', level=2)
plot(bel)

dran <- runifpoint(100, win = as.vector(extent(bel)))
# select only the points within Belgium?
S <- SpatialPoints(data.frame(x = dran$x, y = dran$y), 
            proj4string = CRS(proj4string(belshp)))

out <- extract(bel, S, df = TRUE, sp = TRUE)
out
out <- extract(bel, belshp, na.rm = TRUE, df = TRUE, fun = mean)
out$name <- belshp$NAME_2


plot(out)

?extract
plot(bel)
plot(S, add=TRUE, col = "red", pch = 3)
plot(belshp, add=TRUE)
intersect <- gIntersection(S, belshp)
warnings()
Sover <- over(S, belshp)
Sover
plot(bel)
plot(intersect, add = TRUE)
plot(Sover, add=TRUE, col = "red", pch = 3)
# use the belshp and clip option
# visualise the result and extract data - plot everything into a nice data frame
```

```{r}
## load the googleVis package
suppressPackageStartupMessages(library(googleVis))

##
data(Exports)    # a simple data frame
Geo <- gvisGeoMap(Exports, locationvar="Country", numvar="Profit", 
                  options=list(height=400, dataMode='regions'))
```

```{r, results='asis'}
print(Geo, "chart")  ## same as cat(sc$html$chart)
```

```{r, echo=FALSE}
df <- data.frame(x = 1:10, y = 1:10)
## load the googleVis package
suppressPackageStartupMessages(library(googleVis))
## create the scatter chart
sc <- gvisScatterChart(data=df,
                        options=list(width=300, height=300, 
                                     legend='none',
                                     hAxis="{title:'x'}",
                                     vAxis="{title:'y'}")
          )
plot(sc)
```

```{r, results='asis', echo=FALSE}
print(sc, "chart")  ## same as cat(sc$html$chart)
```


### The contribution of scripting

- automation: being able to use this script for analysis of any location in the world
- reprodubility
- quick and efficient analysis

### Basic scriping skills required

- being able to download data
- handle raster and vector data
- spatial analysis (point sampling)
- visualise things.

## An automated raster processing chain (from data download to final map)

### The example

### Contribution of scripting

* Reproducibility

### Basic scipting skills required

* String handling
* List queries
* Error handling

## Interactive maps

The map below (created using the googleVis package) displays statistics about the national parks of Europe. The data is automatically read from [the wikipedia page](http://en.wikipedia.org/wiki/List_of_national_parks#Europe), cleaned and formatted in a data frame, and a webmap is created using the `gvisGeoChart()` function. If you hover over the dots, the value of the mapped variables is displayed. The googleVis package provides wrappers to easily produce such kind of maps using the [google visualization API](https://google-developers.appspot.com/chart/interactive/docs/gallery/geochart).

```{r, echo=FALSE, results='asis'}
library(googleVis)
library(XML)

# Read table from html
url <- "http://en.wikipedia.org/wiki/List_of_national_parks"
x <- readHTMLTable(readLines(url), which=3, stringsAsFactors = FALSE)

# Clean up df 
colnames (x) <- c('country', 'oldest', 'number', 'area_tot', 'country_percentage')
x$oldest <- as.numeric(x$oldest)
x$number <- as.numeric(gsub("\\*", "", x$number))
x$area_tot <- as.numeric(gsub("(,)|(\\[.*\\])", "", x$area_tot))
x$country_percentage <- as.numeric(gsub("(%)|(\\[.*\\])", "", x$country_percentage))

nationalParks <- x

g <- gvisGeoChart(nationalParks, locationvar="country", colorvar = "oldest", sizevar = "number",
                  options=list(region="150", displayMode="markers", colorAxis="{colors: ['green', 'blue']}"))
print('<center>')
print(g)
print('</center>')
```

## A shiny map

The above map is nice, but still pretty static; it only display two variables, which we did not choose. The year the first park was created for the dot color, and the total number of parks in the country for the dot size. To make that map a bit more interactive we can embed it in a shiny App. Shiny is among the lattest developments of the R world, supported by RStudio; it provides the possibility to create interactive plots. These app can either be ran in an RStudio session or online.
The app below allows you to select the variables you want to map relating to national park of europe.

<center>
<iframe src="http://loicd.shinyapps.io/shinyGoogleVis" width="600" height="750" frameborder="0">Loading</iframe>
</center>

### Contribution of scripting
### Basic scipting skills required

* dataframe manipulation



# Today's summary

To summarize, we saw today that scripting can be used for many purposes:

* Automate steps and deal with large amounts of data
* Solve complex problems (run custom made functions, while traditional GIS environments are limited to the features they provide)
* Make work reproducible (also beneficial for collaboration)
* Visualize data and build interactive geo data visualization tools


# Assignment

Submit a 1/2 page document where you identify the potential contribution of Geo-scripting for yourself, as well as the specific R or python knowledge you would need to learn about. Keep it short, to the point and structured.


# Inspiration and More info

- http://www.magesblog.com/2012/05/interactive-reports-in-r-with-knitr-and.html

Yet another tutorial:

- https://pakillo.github.io/R-GIS-tutorial/
- http://github.com/mages/googleVis

About projections and code: https://www.nceas.ucsb.edu/scicomp/recipes/projections


<!--Demonstrate potential
Trigger interest
Help students mapping (in their mind) the concepts and knowledge they will learn and require later in the course
This will be done by providing showcases of about everything (data manipulation, visualization, Analysis). Every showcase fill be followed by:
A reflection on what is the interest of using scripting for that particular problem
An assessment of the R knowledge required to perform that particular problem
This lesson should be structured analogically to the course overall.

Example showcases:
An automated raster processing chain (from raw input (or download) to end product)
Make a reproducible map
Extract features immediately followed by statistical analysis
Communicate result with a beautiful interactive (shiny) map
Bonus: If every showcase is embedded into a real world story, that is definitely a bonus
-->


